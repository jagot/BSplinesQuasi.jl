<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Approximating operators · BSplinesQuasi</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/><script src="../assets/latex.js"></script></head><body><nav class="toc"><a href="../"><img class="logo" src="../assets/logo.svg" alt="BSplinesQuasi logo"/></a><h1>BSplinesQuasi</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><a class="toctext" href="../theory/">Theory</a></li><li><span class="toctext">Usage</span><ul><li><a class="toctext" href="../usage/">Basis creation</a></li><li><a class="toctext" href="../knot_sets/">Knot sets</a></li><li><span class="toctext">Splines</span><ul><li><a class="toctext" href="../splines/">Spline creation &amp; evaluation</a></li><li><a class="toctext" href="../function_approximation/">Function approximation</a></li></ul></li><li class="current"><a class="toctext" href>Approximating operators</a><ul class="internal"><li><a class="toctext" href="#Differential-operators-1">Differential operators</a></li><li><a class="toctext" href="#Diagonal-operators-1">Diagonal operators</a></li></ul></li><li><span class="toctext">Examples</span><ul><li><a class="toctext" href="../differentiation/">Differentiating functions</a></li><li><a class="toctext" href="../odes/">Ordinary differential equations</a></li></ul></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Usage</li><li><a href>Approximating operators</a></li></ul><a class="edit-page" href="https://github.com/jagot/BSplinesQuasi.jl/blob/master/docs/src/operators.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Approximating operators</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Approximating-operators-1" href="#Approximating-operators-1">Approximating operators</a></h1><p>As mentioned in <a href="../theory/#Solving-equations-1">Solving equations</a>, the action of a linear operator on a spline can be approximated by projecting the operator into the space <span>$\space{P}_{t,k}$</span>: <span>$\mat{L}\defd B^H\operator{L}B$</span>. We can employ this for different kinds of operators; out-of-the-box, BSplinesQuasi.jl supports differential operators and diagonal operators:</p><h2><a class="nav-anchor" id="Differential-operators-1" href="#Differential-operators-1">Differential operators</a></h2><p>In the ContinuumArrays framework, differential operators are represented by the <code>Derivative</code> operator, which operates in a domain (typically the first axis of an <code>ContinuumArrays.QuasiArrays.AbstractQuasiMatrix</code>, e.g. a <code>ContinuumArrays.Basis</code> such as <a href="../splines/#BSplinesQuasi.BSpline"><code>BSpline</code></a>):</p><pre><code class="language-julia">julia&gt; using BSplinesQuasi

julia&gt; B = BSpline(LinearKnotSet(3, 0, 1, 3))
BSpline{Float64} basis with LinearKnotSet(Float64) of order k = 3 (parabolic) on 0.0..1.0 (3 intervals)

julia&gt; D = Derivative(axes(B,1))
Derivative{Float64,IntervalSets.Interval{:closed,:closed,Float64}}(ContinuumArrays.QuasiArrays.Inclusion{Float64,IntervalSets.Interval{:closed,:closed,Float64}}(0.0..1.0))</code></pre><p>The derivative operator can then be projected into the space generated by the knot set <code>t</code> by</p><pre><code class="language-julia">julia&gt; ∇ = B&#39;D*B
5×5 BandedMatrix{Float64,Array{Float64,2},Base.OneTo{Int64}}:
 -0.5         0.416667      0.0833333      ⋅            ⋅
 -0.416667    2.07997e-17   0.375         0.0416667     ⋅
 -0.0833333  -0.375         7.84759e-17   0.375        0.0833333
   ⋅         -0.0416667    -0.375        -1.31839e-16  0.416667
   ⋅           ⋅           -0.0833333    -0.416667     0.5</code></pre><h2><a class="nav-anchor" id="Diagonal-operators-1" href="#Diagonal-operators-1">Diagonal operators</a></h2><p>Diagonal operators are operators that only depend on the coordinate; they are also called local operators. Typical examples are potentials, such as the Coulomb potential <span>$V(x) = Q/x$</span>, generated by a charge <span>$Q$</span>. This potential is not polynomial, i.e. we cannot compute its matrix elements exactly using Gauß–Legendre quadrature, but with high enough order and intelligent placement of the knots, we can get sufficient accuracy.</p><p>Diagonal operators are projected into the B-spline space using the <code>Matrix</code> function:</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Base.Matrix" href="#Base.Matrix"><code>Base.Matrix</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Matrix(f, B)</code></pre><p>Generate the matrix representing the diagonal operator <code>f</code> in the B-spline space <code>B</code>.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl">julia&gt; Matrix(x -&gt; x, BSpline(LinearKnotSet(3, 0, 1, 3)))
5×5 BandedMatrices.BandedMatrix{Float64,Array{Float64,2},Base.OneTo{Int64}}:
 0.0037037    0.00462963  0.000925926   ⋅           ⋅
 0.00462963   0.0259259   0.0236111    0.00138889   ⋅
 0.000925926  0.0236111   0.0916667    0.0458333   0.00462963
  ⋅           0.00138889  0.0458333    0.0851852   0.0342593
  ⋅            ⋅          0.00462963   0.0342593   0.062963</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/jagot/BSplinesQuasi.jl/blob/1376671410796bc077cd428fbf968806b6e109ac/src/operators.jl#L3-L20">source</a></section><p>As as example of the importance of knot placement, we study the action of the Coulomb operator <span>$\operator{V}(x) = -1/x$</span> on the function <span>$f(x)=x^2\exp(-x)$</span>; we know that the result should be <span>$g(x)=\operator{V}(x)f(x)=-x\exp(-x)$</span>:</p><pre><code class="language-julia">julia&gt; k = 7
7

julia&gt; N = 31
31

julia&gt; a,b = 0,70
(0, 70)

julia&gt; coulomb(r) = -1/r
coulomb (generic function with 1 method)

julia&gt; tlin = LinearKnotSet(k, a, b, N);

julia&gt; texp = ExpKnotSet(k, -1.0, log10(b), N);

julia&gt; Blin = BSpline(tlin,3)[:,2:end-1]
BSpline{Float64} basis with LinearKnotSet(Float64) of order k = 7 on 0.0..70.0 (31 intervals), restricted to basis functions 2..36 ⊂ 1..37

julia&gt; Bexp = BSpline(texp,3)[:,2:end-1]
BSpline{Float64} basis with ExpKnotSet(Float64) of  on order k = 7 on 0,0.1..70.00000000000001 (31 intervals), restricted to basis functions 2..36 ⊂ 1..37</code></pre><p>Then, for <code>B=Blin</code> and <code>B=Bexp</code>, we do the following:</p><pre><code class="language-julia">S = B&#39;B
f = B \ x -&gt; x^2*exp(-x)
V = Matrix(coulomb, B)
g̃ = S \ V*f</code></pre><p>and obtain two different approximations <code>g̃</code> to <span>$g(x)$</span>, as shown in the following plot:</p><p><img src="../figures/diagonal-operators.svg" alt="Coulomb operator"/></p><footer><hr/><a class="previous" href="../function_approximation/"><span class="direction">Previous</span><span class="title">Function approximation</span></a><a class="next" href="../differentiation/"><span class="direction">Next</span><span class="title">Differentiating functions</span></a></footer></article></body></html>
